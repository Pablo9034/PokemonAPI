---
import type { GetStaticPaths } from 'astro';

import Layout from '@layouts/Layout.astro';
import PokemonCard from '@components/PokemonCard.astro';

import { APIResponseSchema } from '@interfaces/pokemon_schemas';

export const getStaticPaths = (async ({ paginate }) => {
    const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=151');
    const data = APIResponseSchema.parse(await response.json());

    return paginate(data.results, { pageSize: 20 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<Layout title={`PokemonAPI | Page ${ page.currentPage }`}>
    <section class="flex flex-col justify-center">
        <ul class="min-h-[450px] lg:min-h-[520px] min-w-[332px] lg:min-w-full grid grid-rows-5 grid-cols-4 content-center gap-3 lg:gap-y-0">
            {
                page.data.map(({ name, url })=>{
                    const id = Number(url.split('/').at(-2));

                    return (
                        <li>
                            <PokemonCard id={ id } name={ name }/>
                        </li>
                    );
                })
            }
        </ul>

        <div class="py-10 flex justify-between items-center font-bold">
            <a href={ page.url.prev } class:list={[
                "w-[72px] text-center py-2 px-3 rounded-md bg-linear-to-b",
                { "from-blue-800 to-blue-900 shadow-md shadow-gray-800 active:scale-90 transition-[scale]": page.url.prev },
                { "from-gray-600/50 to-gray-700/50": !page.url.prev }
            ]}>Before</a>
            
            <h2> Page { page.currentPage }</h2>
            
            <a href={ page.url.next } class:list={[
                "w-[72px] text-center py-2 px-3 rounded-md bg-linear-to-b",
                { "from-blue-800 to-blue-900 shadow-md shadow-gray-800 active:scale-90 transition-[scale]": page.url.next },
                { "from-gray-600/50 to-gray-700/50": !page.url.next }
            ]}>Next</a>
        </div>
    </section>
</Layout>